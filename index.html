<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a4d2e">
    <link rel="icon" href="data:,">
    <title>Organizacijska ≈†ema - ≈†PD Unsko-Sanske ≈†ume</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600&display=swap');
        :root {
            --primary:#1a4d2e; --primary-light:#2d6a4f; --accent:#d4af37;
            --bg-main:#f5f7fa; --bg-card:#ffffff; --text-primary:#1a1a1a;
            --text-secondary:#666; --border:#e0e4e8;
            --shadow:rgba(26,77,46,.08); --shadow-hover:rgba(26,77,46,.15);
            --danger:#dc2626;
            --header-h: 88px;
            --controls-h: 60px;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        html,body{height:100%;overflow-x:hidden;}
        body{font-family:'Work Sans',sans-serif;background:var(--bg-main);color:var(--text-primary);overscroll-behavior:none;}

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);color:white;padding:1rem 1.25rem;box-shadow:0 4px 20px var(--shadow);position:sticky;top:0;z-index:200;}
        .header-top{display:flex;align-items:center;justify-content:space-between;gap:.75rem;}
        .header h1{font-family:'Crimson Pro',serif;font-size:1.35rem;font-weight:700;line-height:1.2;flex:1;}
        .sync-status{display:flex;align-items:center;gap:.4rem;padding:.35rem .75rem;background:rgba(255,255,255,.15);border-radius:20px;font-size:.75rem;white-space:nowrap;}
        .sync-indicator{width:7px;height:7px;border-radius:50%;background:#4ade80;animation:pulse 2s infinite;flex-shrink:0;}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

        /* Platform badge */
        .platform-badge{display:flex;align-items:center;gap:.3rem;padding:.3rem .6rem;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);border-radius:8px;font-size:.7rem;cursor:pointer;transition:all .2s;white-space:nowrap;}
        .platform-badge:hover,.platform-badge:active{background:rgba(255,255,255,.3);}

        /* ‚îÄ‚îÄ PLATFORM SWITCHER MODAL ‚îÄ‚îÄ */
        .platform-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9000;align-items:flex-end;justify-content:center;}
        .platform-modal.active{display:flex;}
        .platform-sheet{background:white;border-radius:20px 20px 0 0;padding:1.5rem 1.5rem calc(1.5rem + var(--safe-bottom));width:100%;max-width:500px;animation:slideUp .3s ease;}
        @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
        .platform-sheet h3{font-family:'Crimson Pro',serif;font-size:1.3rem;font-weight:600;color:var(--primary);margin-bottom:1rem;text-align:center;}
        .platform-options{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;}
        .plat-btn{display:flex;flex-direction:column;align-items:center;gap:.5rem;padding:1.25rem;border:2px solid var(--border);border-radius:12px;background:white;cursor:pointer;transition:all .2s;font-family:'Work Sans',sans-serif;}
        .plat-btn:hover,.plat-btn.active{border-color:var(--primary);background:#f0faf3;}
        .plat-btn.active{border-width:2.5px;}
        .plat-btn span:first-child{font-size:2rem;}
        .plat-btn .plat-name{font-weight:600;color:var(--primary);font-size:.9rem;}
        .plat-btn .plat-desc{font-size:.72rem;color:var(--text-secondary);text-align:center;}

        /* ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ */
        .controls{background:white;border-bottom:1.5px solid var(--border);display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;position:sticky;top:var(--header-h);z-index:190;transition:padding .2s;}
        /* Desktop controls */
        body.mode-desktop .controls{padding:.75rem 1.5rem;}
        body.mode-desktop .controls .btn{padding:.6rem 1.1rem;font-size:.85rem;}
        body.mode-desktop .search-box{min-width:220px;flex:1;}
        /* Mobile controls - compact bottom bar */
        body.mode-mobile .controls{position:fixed;bottom:0;top:auto;left:0;right:0;z-index:190;padding:.5rem .75rem calc(.5rem + var(--safe-bottom));border-bottom:none;border-top:1.5px solid var(--border);box-shadow:0 -4px 16px rgba(0,0,0,.08);justify-content:center;gap:.4rem;background:white;}
        body.mode-mobile .controls .zoom-btns,.controls .action-btns{display:flex;gap:.4rem;}

        .btn{border:none;border-radius:8px;font-family:'Work Sans',sans-serif;font-weight:500;cursor:pointer;transition:all .25s;display:inline-flex;align-items:center;gap:.4rem;touch-action:manipulation;}
        .btn-primary{background:var(--primary);color:white;}
        .btn-primary:active{background:var(--primary-light);transform:scale(.97);}
        .btn-secondary{background:white;color:var(--primary);border:1.5px solid var(--primary);}
        .btn-secondary:active{background:var(--primary);color:white;}
        .btn-danger{background:var(--danger);color:white;}
        .btn-danger:active{background:#b91c1c;}
        .btn-icon{width:40px;height:40px;border-radius:10px;justify-content:center;font-size:1.1rem;padding:0;flex-shrink:0;}
        .btn-small{padding:.4rem .75rem;font-size:.8rem;}
        .search-box{position:relative;flex:1;min-width:0;}
        .search-box input{width:100%;padding:.6rem .9rem .6rem 2.2rem;border:1.5px solid var(--border);border-radius:8px;font-family:'Work Sans',sans-serif;font-size:.875rem;transition:border-color .2s;-webkit-appearance:none;}
        .search-box input:focus{outline:none;border-color:var(--primary);}
        .search-icon{position:absolute;left:.7rem;top:50%;transform:translateY(-50%);color:var(--text-secondary);font-size:.9rem;pointer-events:none;}

        /* Zoom display */
        .zoom-level{font-size:.75rem;color:var(--text-secondary);min-width:36px;text-align:center;font-weight:600;}

        /* ‚îÄ‚îÄ CONTAINER ‚îÄ‚îÄ */
        .container{padding:2rem 1.5rem;overflow:hidden;transition:padding-bottom .2s;}
        body.mode-mobile .container{padding-bottom:90px;}

        /* ‚îÄ‚îÄ ZOOM WRAPPER ‚Äî touch pan/pinch ‚îÄ‚îÄ */
        #zoomWrapper{transform-origin:top left;will-change:transform;transition:transform .05s linear;}
        body.mode-mobile #zoomWrapper{cursor:grab;user-select:none;touch-action:none;}
        body.mode-mobile #zoomWrapper:active{cursor:grabbing;}

        /* ‚îÄ‚îÄ TREE ‚îÄ‚îÄ */
        .tree{display:flex;flex-direction:column;gap:2rem;align-items:center;}
        .tree-node{display:flex;flex-direction:column;align-items:center;position:relative;}
        .node-card{background:var(--bg-card);border:2px solid var(--border);border-radius:12px;padding:1.25rem;min-width:260px;max-width:360px;box-shadow:0 3px 10px var(--shadow);transition:border-color .2s,box-shadow .2s,transform .2s;position:relative;}
        .node-card:hover{border-color:var(--primary);box-shadow:0 6px 20px var(--shadow-hover);transform:translateY(-2px);}
        .node-card.level-0{border-width:3px;border-color:var(--primary);background:linear-gradient(135deg,#fff 0%,#f3faf5 100%);}
        .node-title{font-family:'Crimson Pro',serif;font-size:1.1rem;font-weight:600;color:var(--primary);margin-bottom:.85rem;padding-bottom:.65rem;border-bottom:1.5px solid var(--border);}
        .node-actions{display:flex;gap:.4rem;margin-top:.85rem;padding-top:.75rem;border-top:1px solid var(--border);flex-wrap:wrap;}
        .node-badge{display:inline-block;padding:.2rem .65rem;background:var(--primary);color:white;border-radius:12px;font-size:.7rem;font-weight:600;margin-top:.4rem;}
        .positions-preview{font-size:.82rem;color:var(--text-secondary);padding:.65rem;background:var(--bg-main);border-radius:6px;margin-top:.4rem;cursor:pointer;transition:background .2s;}
        .positions-preview:hover,.positions-preview:active{background:#e1f5e7;}
        .children{display:flex;gap:1.75rem;margin-top:1.75rem;flex-wrap:wrap;justify-content:center;}
        .connector{width:2px;height:28px;background:var(--primary);margin:0 auto;opacity:.7;}

        /* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;align-items:flex-end;justify-content:center;}
        .modal.active{display:flex;}
        body.mode-desktop .modal{align-items:center;}
        .modal-content{background:white;border-radius:20px 20px 0 0;padding:1.75rem 1.75rem calc(1.75rem + var(--safe-bottom));width:100%;max-width:560px;max-height:92vh;overflow-y:auto;animation:slideUp .28s ease;}
        body.mode-desktop .modal-content{border-radius:14px;max-height:90vh;}
        .modal-header{font-size:1.35rem;font-weight:600;margin-bottom:1.25rem;color:var(--primary);display:flex;justify-content:space-between;align-items:center;}
        .close-btn{background:none;border:none;font-size:1.8rem;cursor:pointer;color:var(--text-secondary);line-height:1;padding:.25rem;}
        .close-btn:active{color:var(--danger);}
        .form-group{margin-bottom:1.25rem;}
        .form-group label{display:block;margin-bottom:.45rem;font-weight:500;font-size:.9rem;}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:.75rem;border:1.5px solid var(--border);border-radius:8px;font-family:'Work Sans',sans-serif;font-size:1rem;-webkit-appearance:none;}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary);}
        .modal-actions{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;}
        .modal-actions .btn{padding:.7rem 1.3rem;font-size:.9rem;}

        /* ‚îÄ‚îÄ POZICIJE ‚îÄ‚îÄ */
        .position-item{padding:.65rem .75rem;margin:.35rem 0;background:white;border:1.5px solid var(--border);border-radius:8px;font-size:.84rem;display:flex;align-items:center;gap:.45rem;cursor:move;transition:all .18s;}
        .position-item:hover{background:#fffbeb;border-color:var(--accent);}
        .position-item.dragging{opacity:.5;border-style:dashed;}
        .position-item.drag-over{border-color:var(--primary);background:#e8f5e9;transform:translateY(-2px);}
        .drag-handle{cursor:grab;color:var(--text-secondary);font-size:1.15rem;flex-shrink:0;padding:.1rem;}
        .drag-handle:active{cursor:grabbing;}
        .pos-info{flex:1;display:flex;flex-direction:column;gap:1px;cursor:pointer;user-select:none;min-width:0;}
        .pos-title{font-weight:500;color:var(--text-primary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
        .pos-sub{font-size:.7rem;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
        .koef-col{display:flex;flex-direction:column;gap:3px;align-items:flex-end;flex-shrink:0;}
        .koef-tag{display:inline-flex;align-items:center;padding:.12rem .42rem;border-radius:7px;font-size:.68rem;font-weight:600;white-space:nowrap;}
        .koef-tag.koef-val{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0;}
        .koef-tag.koef-ur{background:#dbeafe;color:#1e40af;border:1px solid #bfdbfe;}
        .koef-tag.koef-stat{background:#fef3c7;color:#92400e;border:1px solid #fde68a;}
        .emp-tag{font-size:.72rem;color:var(--text-secondary);white-space:nowrap;flex-shrink:0;}
        .position-actions{display:flex;gap:.35rem;flex-shrink:0;}

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast{position:fixed;bottom:calc(1.5rem + var(--safe-bottom));left:50%;transform:translateX(-50%);background:var(--primary);color:white;padding:.85rem 1.4rem;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.2);z-index:9999;font-size:.88rem;font-weight:500;white-space:nowrap;animation:toastIn .3s ease;}
        body.mode-mobile .toast{bottom:calc(80px + var(--safe-bottom));}
        @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

        /* Unit selector */
        .unit-selector{margin:.75rem 0;padding:.9rem;background:var(--bg-main);border-radius:8px;}
        .unit-selector label{display:block;margin-bottom:.45rem;font-weight:500;font-size:.9rem;}
        .unit-selector select{width:100%;padding:.7rem;border:1.5px solid var(--border);border-radius:8px;font-size:.9rem;-webkit-appearance:none;background:white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right .75rem center;background-size:12px;}

        /* Mobile FAB (quick add) */
        .fab{display:none;position:fixed;bottom:calc(76px + var(--safe-bottom));right:1rem;width:52px;height:52px;border-radius:50%;background:var(--accent);color:#1a1a1a;font-size:1.5rem;border:none;box-shadow:0 4px 16px rgba(212,175,55,.5);cursor:pointer;z-index:180;align-items:center;justify-content:center;transition:transform .2s;touch-action:manipulation;}
        body.mode-mobile .fab{display:flex;}
        .fab:active{transform:scale(.92);}

        /* Pinch hint */
        .pinch-hint{position:fixed;bottom:calc(130px + var(--safe-bottom));left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);color:white;padding:.5rem 1rem;border-radius:20px;font-size:.78rem;z-index:500;pointer-events:none;opacity:0;transition:opacity .4s;white-space:nowrap;}
        .pinch-hint.show{opacity:1;}

        /* Mobile card adjustments */
        @media (max-width: 600px) {
            .node-card{min-width:200px;max-width:280px;padding:1rem;}
            .node-title{font-size:1rem;}
            .node-badge{font-size:.65rem;}
            .btn-small{padding:.35rem .6rem;font-size:.75rem;}
            .children{gap:1.25rem;}
        }
    </style>
</head>
<body class="mode-desktop">

    <!-- PLATFORM SWITCHER MODAL -->
    <div class="platform-modal" id="platformModal">
        <div class="platform-sheet">
            <h3>Odaberi prikaz</h3>
            <div class="platform-options">
                <button class="plat-btn" id="platDesktop" onclick="setPlatform('desktop')">
                    <span>üñ•Ô∏è</span>
                    <span class="plat-name">Desktop</span>
                    <span class="plat-desc">Traka alata gore, scroll zoom</span>
                </button>
                <button class="plat-btn" id="platMobile" onclick="setPlatform('mobile')">
                    <span>üì±</span>
                    <span class="plat-name">Android / iOS</span>
                    <span class="plat-desc">Traka alata dole, pinch zoom</span>
                </button>
            </div>
            <div style="margin-top:1rem;text-align:center;">
                <button class="btn btn-secondary btn-small" onclick="closePlatformModal()" style="width:100%;padding:.7rem;">Otka≈æi</button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <div class="header">
        <div class="header-top">
            <h1>üå≤ ≈†PD Unsko-Sanske ≈†ume</h1>
            <div style="display:flex;gap:.5rem;align-items:center;flex-shrink:0;">
                <div class="sync-status"><div class="sync-indicator"></div><span id="syncStatus">Uƒçitavanje...</span></div>
                <button class="platform-badge" onclick="openPlatformModal()" title="Promijeni prikaz">
                    <span id="platIcon">üñ•Ô∏è</span>
                    <span id="platLabel">Desktop</span>
                </button>
            </div>
        </div>
    </div>

    <!-- CONTROLS (desktop: top sticky | mobile: bottom fixed) -->
    <div class="controls" id="controlsBar">
        <div class="action-btns" style="display:flex;gap:.4rem;flex-wrap:wrap;">
            <button class="btn btn-primary btn-small" onclick="addRootUnit()">‚ûï <span class="hide-xs">Dodaj jedinicu</span></button>
            <button class="btn btn-secondary btn-small" onclick="exportData()">üíæ <span class="hide-xs">Spremi</span></button>
            <button class="btn btn-secondary btn-small" onclick="importData()">üìÇ <span class="hide-xs">Uƒçitaj</span></button>
        </div>
        <div class="zoom-btns" style="display:flex;gap:.4rem;align-items:center;">
            <button class="btn btn-secondary btn-icon" onclick="zoomOut()" title="Smanji">‚ûñ</button>
            <span class="zoom-level" id="zoomLabel">100%</span>
            <button class="btn btn-secondary btn-icon" onclick="zoomIn()" title="Poveƒáaj">‚ûï</button>
            <button class="btn btn-secondary btn-icon" onclick="resetZoom()" title="Reset">‚ü≥</button>
        </div>
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" placeholder="Pretra≈æi...">
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container" id="mainContainer">
        <div id="outerScroll" style="overflow:auto;-webkit-overflow-scrolling:touch;">
            <div id="zoomWrapper" style="transform-origin:top left;display:inline-block;min-width:100%;">
                <div class="tree" id="orgTree"></div>
            </div>
        </div>
    </div>

    <!-- FAB (mobile) -->
    <button class="fab" onclick="addRootUnit()" title="Dodaj jedinicu">‚ûï</button>

    <!-- Pinch hint -->
    <div class="pinch-hint" id="pinchHint">ü§è Koristite dva prsta za zoom</div>

    <!-- MODALS -->
    <div class="modal" id="unitModal">
        <div class="modal-content">
            <div class="modal-header"><span id="modalTitle">Dodaj jedinicu</span><button class="close-btn" onclick="closeUnitModal()">√ó</button></div>
            <form id="unitForm">
                <div class="form-group"><label>Naziv jedinice *</label><input type="text" id="unitName" required autocomplete="off"></div>
                <div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="closeUnitModal()">Otka≈æi</button><button type="submit" class="btn btn-primary">Saƒçuvaj</button></div>
            </form>
        </div>
    </div>

    <div class="modal" id="positionModal">
        <div class="modal-content">
            <div class="modal-header"><span id="posModalTitle">Pozicije</span><button class="close-btn" onclick="closePositionModal()">√ó</button></div>
            <div id="positionsList"></div>
            <div class="modal-actions" style="flex-wrap:wrap;">
                <button type="button" class="btn btn-primary btn-small" onclick="addPosition()">‚ûï Dodaj poziciju</button>
                <button type="button" class="btn btn-secondary btn-small" onclick="movePositionToUnit()">‚ÜîÔ∏è Premjesti</button>
                <button type="button" class="btn btn-secondary btn-small" onclick="closePositionModal()">Zatvori</button>
            </div>
        </div>
    </div>

    <div class="modal" id="moveModal">
        <div class="modal-content">
            <div class="modal-header"><span>Premjesti poziciju</span><button class="close-btn" onclick="closeMoveModal()">√ó</button></div>
            <div class="unit-selector"><label>Odaberi odredi≈°nu jedinicu:</label><select id="targetUnitSelect"></select></div>
            <div style="margin:.75rem 0;padding:.85rem;background:#fffbeb;border-radius:8px;font-size:.88rem;"><strong>Pozicija:</strong> <span id="movingPositionName"></span></div>
            <div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="closeMoveModal()">Otka≈æi</button><button type="button" class="btn btn-primary" onclick="confirmMovePosition()">Premjesti</button></div>
        </div>
    </div>

    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header"><span id="empModalTitle">Radnik</span><button class="close-btn" onclick="closeEmployeeModal()">√ó</button></div>
            <form id="employeeForm">
                <div class="form-group"><label>Ime radnika</label><input type="text" id="empName" placeholder="npr. Ime Prezime" autocomplete="off"></div>
                <div class="form-group"><label>Struƒçna sprema</label><input type="text" id="empEducation" placeholder="npr. VSS ‚Äì In≈æinjer ≈°umarstva" autocomplete="off"></div>
                <div class="form-group"><label>Radno iskustvo</label><input type="text" id="empExperience" placeholder="npr. 10 godina" autocomplete="off"></div>
                <div class="form-group"><label>Ostalo</label><textarea id="empOther" rows="4" placeholder="Napomene, certifikati, licence..."></textarea></div>
                <div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="closeEmployeeModal()">Otka≈æi</button><button type="submit" class="btn btn-primary">Saƒçuvaj</button></div>
            </form>
        </div>
    </div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GLOBALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Helper functions for position objects
function p_(title, stepen, koef, usloviRada) {
    usloviRada = usloviRada || 0;
    const ukupno = Math.round((koef * (1 + usloviRada / 100)) * 100) / 100;
    return {
        title, stepen: stepen || '', koef: koef || null,
        usloviRada: usloviRada || 0,
        ukupno: (usloviRada > 0 ? ukupno : koef) || null,
        employee: { name: '', education: '', experience: '', other: '' }
    };
}
function pu_(title, stepen, napomena) {
    return {
        title, stepen: stepen || '', koef: null, usloviRada: 0, ukupno: null,
        napomena: napomena || 'Ugovor - Statut',
        employee: { name: '', education: '', experience: '', other: '' }
    };
}

let organizationalStructure = {
    id: "uprava", name: "UPRAVA", level: 0,
    children: [
        { name: "URED DIREKTORA", id: "ured_direktora", level: 1 },
        { name: "ODJEL INTERNE REVIZIJE", id: "odjel_interne_revizije", level: 1 },
        { name: "ODJELJENJE INTERNE KONTROLE", id: "odjeljenje_interne_kontrole", level: 1 },
        { name: "ODJELJENJE ZA JAVNE NABAVKE", id: "odjeljenje_javne_nabavke", level: 1 },
        { name: "ODJELJENJE MATERIJALNO FINANSIJSKOG UPRAVLJANJA I KONTROLE", id: "odjeljenje_mfuk", level: 1 },
        { name: "ODJELJENJE ZA GEODETSKE POSLOVE", id: "odjeljenje_geodetski", level: 1 },
        { name: "SEKTOR PRIPREME PROIZVODNJE", id: "sektor_priprema", level: 1 },
        { name: "SEKTOR ISKORI≈†TAVANJA ≈†UMA", id: "sektor_iskoristavanje", level: 1 },
        {
            name: "SEKTOR ZA UZGAJANJE ≈†UMA I LOVSTVO", id: "sektor_uzgajanje", level: 1,
            children: [
                { name: "SLU≈ΩBA ZA PO≈†UMLJAVANJE I SJEMENARSTVO", id: "sluzba_posumljavanje", level: 2 },
                { name: "SLU≈ΩBA ZA LOVSTVO I POLJOPRIVREDU", id: "sluzba_lovstvo", level: 2 }
            ]
        },
        { name: "SEKTOR INTEGRALNE ZA≈†TITE ≈†UMA", id: "sektor_zastita", level: 1 },
        { name: "SEKTOR ZA EKOLOGIJU I ZA≈†TITNE ≈†UME", id: "sektor_ekologija", level: 1 },
        { name: "SEKTOR UREƒêIVANJA ≈†UMA", id: "sektor_uredjivanje", level: 1 },
        { name: "SEKTOR INFORMATIƒåKIH POSLOVA", id: "sektor_it", level: 1 },
        {
            name: "SEKTOR PRAVNIH POSLOVA", id: "sektor_pravni", level: 1,
            children: [
                { name: "SLU≈ΩBA ZA IMOVINSKO-PRAVNE POSLOVE", id: "sluzba_imovinsko_pravni", level: 2 },
                { name: "SLU≈ΩBA ZA KADROVSKE I OPƒÜE POSLOVE", id: "sluzba_kadrovski", level: 2 },
                { name: "SLU≈ΩBA ZA ZA≈†TITU ZAPOSLENIKA, IMOVINE I PPZ", id: "sluzba_zastita_zaposleni", level: 2 }
            ]
        },
        {
            name: "SEKTOR EKONOMSKIH POSLOVA", id: "sektor_ekonomski", level: 1,
            children: [
                { name: "SLU≈ΩBA PLANA, ANALIZE I RAZVOJA", id: "sluzba_plan", level: 2 },
                { name: "SLU≈ΩBA ZA KOMERCIJALNE POSLOVE", id: "sluzba_komercijalni", level: 2 },
                { name: "SLU≈ΩBA ZA FINANSIJSKE POSLOVE", id: "sluzba_finansijski", level: 2 },
                { name: "SLU≈ΩBA ZA RAƒåUNOVODSTVO", id: "sluzba_racunovodstvo", level: 2 }
            ]
        },
        {
            name: "PODRU≈ΩNICE", id: "podruznice", level: 1,
            children: [
                { name: "PODRU≈ΩNICA ≈†UMARIJA BIHAƒÜ", id: "podruznica_bihac", level: 2 },
                { name: "PODRU≈ΩNICA ≈†UMARIJA BOSANSKI PETROVAC", id: "podruznica_petrovac", level: 2 },
                { name: "PODRU≈ΩNICA ≈†UMARIJA SANSKI MOST", id: "podruznica_sanski", level: 2 },
                { name: "PODRU≈ΩNICA ≈†UMARIJA KLJUƒå", id: "podruznica_kljuc", level: 2 },
                { name: "PODRU≈ΩNICA ≈†UMARIJA CAZIN", id: "podruznica_cazin", level: 2 },
                { name: "PODRU≈ΩNICA RASADNIK CAZIN", id: "podruznica_rasadnik", level: 2 },
                { name: "POGON GOSPODARENJA ZA OPƒÜINU BOSANSKA KRUPA", id: "pogon_krupa", level: 2 },
                { name: "PODRU≈ΩNICA GRAƒêENJE MEHANIZACIJA I ODR≈ΩAVANJE BOSANSKI PETROVAC", id: "podruznica_gradjenje", level: 2 }
            ]
        }
    ]
};

let orgPositions = {

    // ‚îÄ‚îÄ UPRAVA (r.b. 1-4 - ugovor/Statut) ‚îÄ‚îÄ
    "UPRAVA": [
      pu_("Direktor - Predsjednik Uprave",                     "ƒålan 61. Statuta",        "Ugovor - ƒçlan 56. stav (1) Statuta"),
      pu_("Izvr≈°ni direktor za oblast ≈°umarstva - ƒålan Uprave","ƒålan 61. Statuta",        "Ugovor - ƒçlan 56. stav (2) Statuta"),
      pu_("Izvr≈°ni direktor za oblast ekonomije - ƒålan Uprave","ƒålan 61. Statuta",        "Ugovor - Statut"),
      pu_("Izvr≈°ni direktor za oblast prava - ƒålan Uprave",    "ƒålan 61. Statuta",        "Ugovor - Statut")
    ],

    // ‚îÄ‚îÄ URED DIREKTORA ‚îÄ‚îÄ
    "URED DIREKTORA": [
      p_("≈†ef ureda direktora",                               "VSS VII/240-300 ECTS",    3.60),
      pu_("Sekretar ≈†PD-a",                                   "ƒålan 25. Statuta",        "Ugovor - ƒçlan 25. stav (4) Statuta"),
      p_("Struƒçni saradnik za nauƒçno-istra≈æivaƒçki rad",       "VSS VII/240-300 ECTS",    3.20),
      p_("Struƒçni saradnik za upravljanje promjenama i razvoj","VSS VII/240-300 ECTS",   3.20),
      p_("Struƒçni saradnik za razvoj i pripremu projekata",   "VSS VII/240-300 ECTS",    3.20),
      p_("Struƒçni saradnik za certificiranje",                "VSS VII/240-300 ECTS",    3.20),
      p_("Referent informisanja",                             "VSS VII/180-240 ECTS",    2.69),
      p_("Sekretarica Uprave",                                "SSS",                     1.90),
      p_("Vozaƒç direktora",                                   "SSS/KV",                  2.09)
    ],

    // ‚îÄ‚îÄ ODJEL INTERNE REVIZIJE ‚îÄ‚îÄ
    "ODJEL INTERNE REVIZIJE": [
      pu_("Direktor odjela interne revizije",                 "VSS VII/240 ECTS",        "Ugovor - ƒçlan 80. Statuta"),
      p_("Rukovodilac jedinice - Glavni interni revizor",     "VSS VII/240 ECTS",        3.40),
      p_("Interni revizor (1)",                               "VSS VII/240 ECTS",        3.20),
      p_("Interni revizor (2)",                               "VSS VII/240 ECTS",        3.20),
      p_("Interni revizor (3)",                               "VSS VII/240 ECTS",        3.20)
    ],

    // ‚îÄ‚îÄ ODJELJENJE INTERNE KONTROLE ‚îÄ‚îÄ
    "ODJELJENJE INTERNE KONTROLE": [
      p_("Rukovodilac odjeljenja interne kontrole",           "VSS VII/240-300 ECTS",    3.20),
      p_("Tehniƒçki kontrolor (1)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (2)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (3)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (4)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (5)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (6)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (7)",                            "VSS VII/180 ECTS / SSS",  2.11, 4),
      p_("Tehniƒçki kontrolor (8)",                            "VSS VII/180 ECTS / SSS",  2.11, 4)
    ],

    // ‚îÄ‚îÄ ODJELJENJE ZA JAVNE NABAVKE ‚îÄ‚îÄ
    "ODJELJENJE ZA JAVNE NABAVKE": [
      p_("Rukovodilac - Slu≈æbenik za javne nabavke",          "VSS VII/240 ECTS",        3.20),
      p_("Referent za javne nabavke (1)",                     "VSS VII/180-240 ECTS",    2.60),
      p_("Referent za javne nabavke (2)",                     "VSS VII/180-240 ECTS",    2.60),
      p_("Referent za javne nabavke (3)",                     "VSS VII/180-240 ECTS",    2.60)
    ],

    // ‚îÄ‚îÄ ODJELJENJE MATERIJALNO FINANSIJSKOG UPRAVLJANJA I KONTROLE ‚îÄ‚îÄ
    "ODJELJENJE MATERIJALNO FINANSIJSKOG UPRAVLJANJA I KONTROLE": [
      p_("Rukovodilac odjeljenja MF upravljanja i kontrole",  "VSS VII/180-240 ECTS",    3.20),
      p_("Kontrolor MF poslovanja - Likvidator (1)",          "VSS VII/180-240 ECTS",    2.89),
      p_("Kontrolor MF poslovanja - Likvidator (2)",          "VSS VII/180-240 ECTS",    2.89),
      p_("Kontrolor MF poslovanja - Likvidator (3)",          "VSS VII/180-240 ECTS",    2.89),
      p_("Kontrolor MF poslovanja - Likvidator (4)",          "VSS VII/180-240 ECTS",    2.89),
      p_("Kontrolor MF poslovanja - Likvidator (5)",          "VSS VII/180-240 ECTS",    2.89),
      p_("Kontrolor MF poslovanja - Likvidator (6)",          "VSS VII/180-240 ECTS",    2.89),
      p_("Kontrolor MF poslovanja - Likvidator (7)",          "VSS VII/180-240 ECTS",    2.89)
    ],

    // ‚îÄ‚îÄ ODJELJENJE ZA GEODETSKE POSLOVE ‚îÄ‚îÄ
    "ODJELJENJE ZA GEODETSKE POSLOVE": [
      p_("Rukovodilac odjeljenja za geodetske poslove",       "VSS VII/180-240 ECTS",    3.20),
      p_("Referent za geodetske poslove",                     "SSS",                     2.17),
      p_("Geometar (1)",                                      "SSS",                     2.17, 6),
      p_("Geometar (2)",                                      "SSS",                     2.17, 6),
      p_("Geometar (3)",                                      "SSS",                     2.17, 6),
      p_("Geometar (4)",                                      "SSS",                     2.17, 6),
      p_("Operater",                                          "SSS",                     1.76)
    ],

    // ‚îÄ‚îÄ SEKTOR PRIPREME PROIZVODNJE ‚îÄ‚îÄ
    "SEKTOR PRIPREME PROIZVODNJE": [
      p_("Rukovodilac sektora pripreme proizvodnje",          "VSS VII/240-300 ECTS",    3.60),
      p_("Tehnolog za praƒáenje ≈°umsko-gospodarskih osnova",   "VSS VII/240-300 ECTS",    2.80),
      p_("Vodeƒái projektant (1)",                             "VSS VII/240-300 ECTS",    3.20, 5),
      p_("Vodeƒái projektant (2)",                             "VSS VII/240-300 ECTS",    3.20, 5),
      p_("Vodeƒái projektant (3)",                             "VSS VII/240-300 ECTS",    3.20, 5),
      p_("Vodeƒái projektant (4)",                             "VSS VII/240-300 ECTS",    3.20, 5),
      p_("Vodeƒái projektant (5)",                             "VSS VII/240-300 ECTS",    3.20, 5),
      p_("Vodeƒái projektant (6)",                             "VSS VII/240-300 ECTS",    3.20, 5),
      p_("Projektant u visokim ≈°umama",                       "VSS VII/240-300 ECTS",    3.00, 10),
      p_("Projektant u izdanaƒçkim ≈°umama",                    "VSS VII/180-240 ECTS/SSS",2.09, 10),
      p_("Pomoƒáni projektant",                                "VSS VII/180-300 ECTS",    2.20, 10),
      p_("Referent za administrativno-tehniƒçke poslove",      "SSS",                     1.90),
      p_("Operater (1)",                                      "SSS",                     1.76),
      p_("Operater (2)",                                      "SSS",                     1.76),
      p_("Operater (3)",                                      "SSS",                     1.76),
      p_("Operater (4)",                                      "SSS",                     1.76),
      p_("Operater (5)",                                      "SSS",                     1.76),
      p_("Pomoƒáni radnik u pripremi proizvodnje",             "NK",                      1.40, 10)
    ],

    // ‚îÄ‚îÄ SEKTOR ISKORI≈†TAVANJA ≈†UMA ‚îÄ‚îÄ
    "SEKTOR ISKORI≈†TAVANJA ≈†UMA": [
      p_("Rukovodilac sektora iskori≈°tavanja ≈°uma",           "VSS VII/240-300 ECTS",    3.49),
      p_("Referent za putnu infrastrukturu i objekte",        "VSS VII/180-240 ECTS",    2.87),
      p_("Referent za mehanizaciju",                          "VSS VII/180-240 ECTS",    2.87),
      p_("Evidentiƒçar direkcije",                             "SSS",                     1.95),
      p_("Vozaƒç direkcije - kat. B",                          "SSS/KV kat. B",           1.81),
      p_("Vozaƒç direkcije - kat. D",                          "SSS/KV kat. D",           1.90)
    ],

    // ‚îÄ‚îÄ SEKTOR ZA UZGAJANJE ≈†UMA I LOVSTVO ‚îÄ‚îÄ
    "SEKTOR ZA UZGAJANJE ≈†UMA I LOVSTVO": [
      p_("Rukovodilac sektora uzgajanja ≈°uma i lovstva",      "VSS VII/240-300 ECTS",    3.49)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA PO≈†UMLJAVANJE I SJEMENARSTVO ‚îÄ‚îÄ
    "SLU≈ΩBA ZA PO≈†UMLJAVANJE I SJEMENARSTVO": [
      p_("Rukovodilac slu≈æbe za po≈°umljavanje i sjemenarstvo","VSS VII/240-300 ECTS",    3.00, 8),
      p_("Referent za po≈°umljavanje i sjemenarstvo (1)",      "VSS VII/180-240 ECTS",    2.60),
      p_("Referent za po≈°umljavanje i sjemenarstvo (2)",      "VSS VII/180-240 ECTS",    2.60)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA LOVSTVO I POLJOPRIVREDU ‚îÄ‚îÄ
    "SLU≈ΩBA ZA LOVSTVO I POLJOPRIVREDU": [
      p_("Rukovodilac slu≈æbe za lovstvo i poljoprivredu",     "VSS VII/180-240 ECTS",    3.00, 8),
      p_("Lovoƒçuvar",                                         "SSS",                     1.62, 6),
      p_("Pomoƒáni radnik u lovi≈°tu",                          "NK",                      1.40, 10)
    ],

    // ‚îÄ‚îÄ SEKTOR INTEGRALNE ZA≈†TITE ≈†UMA ‚îÄ‚îÄ
    "SEKTOR INTEGRALNE ZA≈†TITE ≈†UMA": [
      p_("Rukovodilac sektora integralne za≈°tite ≈°uma",       "VSS VII/240-300 ECTS",    3.49),
      p_("Referent za≈°tite ≈°uma",                             "VSS VII/240-300 ECTS",    3.09)
    ],

    // ‚îÄ‚îÄ SEKTOR ZA EKOLOGIJU I ZA≈†TITNE ≈†UME ‚îÄ‚îÄ
    "SEKTOR ZA EKOLOGIJU I ZA≈†TITNE ≈†UME": [
      p_("Rukovodilac sektora za ekologiju i za≈°titne ≈°ume",  "VSS VII/240-300 ECTS",    3.49),
      p_("Referent ekologije i za≈°titnih ≈°uma",               "VSS VII/180-300 ECTS",    2.60),
      p_("Terenski operativac",                               "SSS",                     1.90),
      p_("Poslovoƒëa ≈°umarske radionice",                      "SSS",                     2.09),
      p_("Poslovoƒëa stolarske radionice",                     "V≈†S",                     2.20),
      p_("Rukovaoc brentom i stolarskim ma≈°inama",            "KV",                      1.81, 6),
      p_("Pomoƒánik rukovaoca brentom i stol. ma≈°inama (1)",   "PK/NK",                   1.62),
      p_("Pomoƒánik rukovaoca brentom i stol. ma≈°inama (2)",   "PK/NK",                   1.62),
      p_("Tesar - Zidar - Bravar - Vilju≈°karista",            "KV",                      1.67, 6),
      p_("Traktorista poljopr. traktora - Pomoƒáni radnik",    "KV/PK",                   1.67, 6),
      p_("Rukovaoc CNC ma≈°ine - Programer",                   "SSS",                     1.81),
      p_("Limar - Pomoƒáni radnik",                            "SSS",                     1.67, 6),
      p_("Plinski i vodoinstalater - Pomoƒáni radnik",         "SSS",                     1.67, 6),
      p_("Pomoƒáni radnik",                                    "NK",                      1.40, 10),
      p_("Portir - Pomoƒáni radnik",                           "SSS/NK",                  1.40)
    ],

    // ‚îÄ‚îÄ SEKTOR UREƒêIVANJA ≈†UMA ‚îÄ‚îÄ
    "SEKTOR UREƒêIVANJA ≈†UMA": [
      p_("Rukovodilac sektora ureƒëivanja ≈°uma",               "VSS VII/240-300 ECTS",    3.60),
      p_("Voƒëa sekcije",                                      "VSS VII/240-300 ECTS",    3.03, 4),
      p_("Referent za GIS",                                   "VSS VII/180-240 ECTS",    2.80),
      p_("Projektant ureƒëivanja ≈°uma",                        "VSS VII/240-300 ECTS",    2.79, 4),
      p_("Projektant na procjeni ≈°uma - Taksator",            "VSS VII/180-240 ECTS/SSS",2.01, 10),
      p_("Vozaƒç",                                             "SSS/KV kat. B",           1.81),
      p_("Pomoƒáni radnik u ureƒëivanju ≈°uma",                  "NK",                      1.40, 10)
    ],

    // ‚îÄ‚îÄ SEKTOR INFORMATIƒåKIH POSLOVA ‚îÄ‚îÄ
    "SEKTOR INFORMATIƒåKIH POSLOVA": [
      p_("Rukovodilac sektora informatiƒçkih poslova",         "VSS VII/240 ECTS",        3.40),
      p_("Informatiƒçar - Programer (1)",                      "VSS VII/180-240 ECTS",    2.80),
      p_("Informatiƒçar - Programer (2)",                      "VSS VII/180-240 ECTS",    2.80),
      p_("Informatiƒçar - Tehniƒçar (1)",                       "SSS",                     2.20),
      p_("Informatiƒçar - Tehniƒçar (2)",                       "SSS",                     2.20)
    ],

    // ‚îÄ‚îÄ SEKTOR PRAVNIH POSLOVA ‚îÄ‚îÄ
    "SEKTOR PRAVNIH POSLOVA": [
      p_("Rukovodilac sektora pravnih poslova",               "VSS VII/240 ECTS",        3.49)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA IMOVINSKO-PRAVNE POSLOVE ‚îÄ‚îÄ
    "SLU≈ΩBA ZA IMOVINSKO-PRAVNE POSLOVE": [
      p_("Rukovodilac slu≈æbe za imovinsko-pravne poslove",    "VSS VII/240 ECTS",        3.26),
      p_("Referent za zastupanje",                            "VSS VII/240 ECTS",        2.89),
      p_("Referent za pravne poslove (1)",                    "VSS VII/240 ECTS / V≈†S",  2.60),
      p_("Referent za pravne poslove (2)",                    "VSS VII/240 ECTS / V≈†S",  2.60),
      p_("Referent za pravne poslove (3)",                    "VSS VII/240 ECTS / V≈†S",  2.60),
      p_("Referent za pravne poslove (4)",                    "VSS VII/240 ECTS / V≈†S",  2.60)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA KADROVSKE I OPƒÜE POSLOVE ‚îÄ‚îÄ
    "SLU≈ΩBA ZA KADROVSKE I OPƒÜE POSLOVE": [
      p_("Rukovodilac slu≈æbe za kadrovske i opƒáe poslove",    "VSS VII/240 ECTS",        3.24),
      p_("Referent radnih odnosa",                            "VSS VII/240 ECTS",        2.60),
      p_("Referent protokola (1)",                            "SSS",                     1.95),
      p_("Referent protokola (2)",                            "SSS",                     1.95),
      p_("Arhivar (1)",                                       "SSS",                     1.95),
      p_("Arhivar (2)",                                       "SSS",                     1.95),
      p_("ƒåistaƒçica (1)",                                     "NK",                      1.50),
      p_("ƒåistaƒçica (2)",                                     "NK",                      1.50),
      p_("ƒåistaƒçica (3)",                                     "NK",                      1.50),
      p_("ƒåistaƒçica (4)",                                     "NK",                      1.50),
      p_("Domar - Lo≈æaƒç - Kurir (1)",                         "SSS/KV",                  1.76),
      p_("Domar - Lo≈æaƒç - Kurir (2)",                         "SSS/KV",                  1.76),
      p_("Portir direkcije (1)",                              "SSS",                     1.71),
      p_("Portir direkcije (2)",                              "SSS",                     1.71)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA ZA≈†TITU ZAPOSLENIKA, IMOVINE I PPZ ‚îÄ‚îÄ
    "SLU≈ΩBA ZA ZA≈†TITU ZAPOSLENIKA, IMOVINE I PPZ": [
      p_("Rukovodilac slu≈æbe za za≈°titu zaposlenika, imovine i PPZ","VSS VII/180-240 ECTS",2.90),
      p_("Referent za≈°tite na radu",                          "VSS VII/180-240 ECTS",    2.60),
      p_("Referent PPZ (1)",                                  "VSS VII/180 / SSS",       1.90),
      p_("Referent PPZ (2)",                                  "VSS VII/180 / SSS",       1.90),
      p_("Referent PPZ (3)",                                  "VSS VII/180 / SSS",       1.90),
      p_("Referent PPZ (4)",                                  "VSS VII/180 / SSS",       1.90),
      p_("Referent PPZ (5)",                                  "VSS VII/180 / SSS",       1.90),
      p_("Vozaƒç - Vatrogasac - Pomoƒáni radnik",               "SSS/KV",                  1.68, 10)
    ],

    // ‚îÄ‚îÄ SEKTOR EKONOMSKIH POSLOVA ‚îÄ‚îÄ
    "SEKTOR EKONOMSKIH POSLOVA": [
      p_("Rukovodilac sektora ekonomskih poslova",            "VSS VII/240 ECTS",        3.49)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA PLANA, ANALIZE I RAZVOJA ‚îÄ‚îÄ
    "SLU≈ΩBA PLANA, ANALIZE I RAZVOJA": [
      p_("Rukovodilac slu≈æbe plana, analize i razvoja",       "VSS VII/180-240 ECTS",    3.24),
      p_("Planer - Analitiƒçar (1)",                           "VSS VII/180-240 ECTS",    2.90),
      p_("Planer - Analitiƒçar (2)",                           "VSS VII/180-240 ECTS",    2.90),
      p_("Operativni planer - Statistiƒçar",                   "SSS",                     2.00)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA KOMERCIJALNE POSLOVE ‚îÄ‚îÄ
    "SLU≈ΩBA ZA KOMERCIJALNE POSLOVE": [
      p_("Rukovodilac slu≈æbe za komercijalne poslove",        "VSS VII/180-240 ECTS",    3.24),
      p_("Referent nabave",                                   "VSS VII/180-240 ECTS",    2.80),
      p_("Referent prodaje (1)",                              "VSS VII/180-240 ECTS/V≈†S",2.60),
      p_("Referent prodaje (2)",                              "VSS VII/180-240 ECTS/V≈†S",2.60),
      p_("Referent prodaje (3)",                              "VSS VII/180-240 ECTS/V≈†S",2.60),
      p_("Referent prodaje (4)",                              "VSS VII/180-240 ECTS/V≈†S",2.60),
      p_("Referent prodaje sporednih proizvoda",              "VSS VII/180-240 ECTS/V≈†S",2.40),
      p_("Referent za fakturisanje (1)",                      "SSS",                     1.90),
      p_("Referent za fakturisanje (2)",                      "SSS",                     1.90),
      p_("Referent za fakturisanje (3)",                      "SSS",                     1.90),
      p_("Referent za fakturisanje (4)",                      "SSS",                     1.90),
      p_("Referent za fakturisanje (5)",                      "SSS",                     1.90),
      p_("Magaciner centralnog magacina",                     "SSS",                     1.90),
      p_("Magaciner direkcije i pogona gospodarenja",         "VSS VII/180-240 ECTS",    2.20)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA FINANSIJSKE POSLOVE ‚îÄ‚îÄ
    "SLU≈ΩBA ZA FINANSIJSKE POSLOVE": [
      p_("Rukovodilac slu≈æbe za finansijske poslove",         "VSS VII/180-240 ECTS",    3.24),
      p_("Referent likvidator i naplata (1)",                 "VSS VII/180-240 ECTS/V≈†S",2.60),
      p_("Referent likvidator i naplata (2)",                 "VSS VII/180-240 ECTS/V≈†S",2.60),
      p_("Blagajnik - Obraƒçunski",                            "SSS",                     2.09),
      p_("Prodavaƒç - Obraƒçunski - Pomoƒána blagajna (1)",      "SSS",                     1.90),
      p_("Prodavaƒç - Obraƒçunski - Pomoƒána blagajna (2)",      "SSS",                     1.90),
      p_("Prodavaƒç - Obraƒçunski - Pomoƒána blagajna (3)",      "SSS",                     1.90),
      p_("Prodavaƒç - Obraƒçunski - Pomoƒána blagajna (4)",      "SSS",                     1.90),
      p_("Prodavaƒç - Obraƒçunski - Blagajna - Fakturista (1)", "SSS",                     1.90),
      p_("Prodavaƒç - Obraƒçunski - Blagajna - Fakturista (2)", "SSS",                     1.90)
    ],

    // ‚îÄ‚îÄ SLU≈ΩBA ZA RAƒåUNOVODSTVO ‚îÄ‚îÄ
    "SLU≈ΩBA ZA RAƒåUNOVODSTVO": [
      p_("Rukovodilac slu≈æbe za raƒçunovodstvo",               "VSS VII/180-240 ECTS",    3.29),
      p_("Glavni knjigovoƒëa",                                 "VSS VII/180-240 ECTS/V≈†S",2.76),
      p_("Konter - Finansijski knjigovoƒëa (1)",               "VSS VII/180-240 ECTS",    2.60),
      p_("Konter - Finansijski knjigovoƒëa (2)",               "VSS VII/180-240 ECTS",    2.60),
      p_("Knjigovoƒëa stalnih sredstava i osiguranja",         "SSS",                     2.00),
      p_("Knjigovoƒëa dobavljaƒça",                             "SSS",                     2.00),
      p_("Knjigovoƒëa kupaca (1)",                             "SSS",                     2.00),
      p_("Knjigovoƒëa kupaca (2)",                             "SSS",                     2.00),
      p_("Knjigovoƒëa plaƒáa",                                  "SSS",                     2.00),
      p_("Knjigovoƒëa za obraƒçun i evidenciju poreza",         "SSS",                     2.00),
      p_("Knjigovoƒëa centralnog magacina",                    "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (1)",        "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (2)",        "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (3)",        "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (4)",        "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (5)",        "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (6)",        "SSS",                     1.90),
      p_("Knjigovoƒëa mat. i pogon. knjigovodstva (7)",        "SSS",                     1.90)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA ≈†UMARIJA BIHAƒÜ ‚ïê‚ïê
    "PODRU≈ΩNICA ≈†UMARIJA BIHAƒÜ": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.81),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    3.24),
      p_("Tehnolog za gospodarenje ≈°umama",                   "VSS VII/240-300 ECTS",    3.09, 5),
      p_("Evidentiƒçar",                                       "SSS",                     1.81),
      p_("Administrativni radnik - Operater",                 "SSS",                     1.81),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (1)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (2)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (3)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (1)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (2)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (3)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (4)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa vlastite re≈æije",                         "VSS VII/180 / SSS",       2.07, 6),
      p_("Primaƒç na ≈°uma panju (1)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (2)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (3)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (4)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (5)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (6)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (7)",                          "SSS",                     2.10, 10),
      p_("Radnik u primci (1)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (2)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (3)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (4)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (5)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (6)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (7)",                               "SSS",                     1.75, 10),
      p_("Otpremaƒç drvnih sortimenata (1)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (2)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (3)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (4)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (5)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (6)",                   "SSS",                     1.95, 5),
      p_("Osmatraƒç ≈°uma i ≈°umskog zemlji≈°ta",                 "SSS/KV",                  1.75, 10),
      p_("Vozaƒç - Pomoƒáni radnik (1)",                        "SSS/KV kat. B",           1.81),
      p_("Vozaƒç - Pomoƒáni radnik (2)",                        "SSS/KV kat. B",           1.81),
      p_("Domar - Lo≈æaƒç - Kurir",                             "SSS/KV",                  1.76),
      p_("ƒåistaƒçica",                                         "NK",                      1.50),
      p_("Sjekaƒç (1)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (2)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (3)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (4)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (5)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (6)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (7)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (8)",                                        "PK",                      1.64, 10),
      p_("Uzgojni radnik",                                    "PK",                      1.56, 10),
      p_("Traktorista - Pomoƒáni radnik (1)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (2)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (3)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (4)",                  "KV/PK",                   1.75, 10),
      p_("Automehaniƒçar",                                     "KV",                      1.81, 6)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA ≈†UMARIJA BOSANSKI PETROVAC ‚ïê‚ïê
    "PODRU≈ΩNICA ≈†UMARIJA BOSANSKI PETROVAC": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    4.00),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    3.24),
      p_("Tehnolog za gospodarenje ≈°umama",                   "VSS VII/240-300 ECTS",    3.09, 5),
      p_("Evidentiƒçar",                                       "SSS",                     1.81),
      p_("Administrativni radnik - Operater",                 "SSS",                     1.81),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (1)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (2)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (3)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (1)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (2)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (3)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (4)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa vlastite re≈æije",                         "VSS VII/180 / SSS",       2.07, 6),
      p_("Primaƒç na ≈°uma panju (1)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (2)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (3)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (4)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (5)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (6)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (7)",                          "SSS",                     2.10, 10),
      p_("Radnik u primci (1)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (2)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (3)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (4)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (5)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (6)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (7)",                               "SSS",                     1.75, 10),
      p_("Otpremaƒç drvnih sortimenata (1)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (2)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (3)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (4)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (5)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (6)",                   "SSS",                     1.95, 5),
      p_("Osmatraƒç ≈°uma i ≈°umskog zemlji≈°ta",                 "SSS/KV",                  1.75, 10),
      p_("Vozaƒç - Pomoƒáni radnik (1)",                        "SSS/KV kat. B",           1.81),
      p_("Vozaƒç - Pomoƒáni radnik (2)",                        "SSS/KV kat. B",           1.81),
      p_("Domar - Lo≈æaƒç - Kurir",                             "SSS/KV",                  1.76),
      p_("ƒåistaƒçica",                                         "NK",                      1.50),
      p_("Sjekaƒç (1)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (2)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (3)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (4)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (5)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (6)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (7)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (8)",                                        "PK",                      1.64, 10),
      p_("Uzgojni radnik",                                    "PK",                      1.56, 10),
      p_("Traktorista - Pomoƒáni radnik (1)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (2)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (3)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (4)",                  "KV/PK",                   1.75, 10),
      p_("Automehaniƒçar",                                     "KV",                      1.81, 6)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA ≈†UMARIJA SANSKI MOST ‚ïê‚ïê
    "PODRU≈ΩNICA ≈†UMARIJA SANSKI MOST": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.81),
      p_("Pomoƒánik upravnika (1)",                            "VSS VII/240-300 ECTS",    3.24),
      p_("Pomoƒánik upravnika (2)",                            "VSS VII/240-300 ECTS",    3.24),
      p_("Tehnolog za gospodarenje ≈°umama",                   "VSS VII/240-300 ECTS",    3.09, 5),
      p_("Evidentiƒçar",                                       "SSS",                     1.81),
      p_("Administrativni radnik - Operater",                 "SSS",                     1.81),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (1)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (2)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (3)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (4)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (5)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (1)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (2)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (3)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa vlastite re≈æije",                         "VSS VII/180 / SSS",       2.07, 6),
      p_("Primaƒç na ≈°uma panju (1)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (2)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (3)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (4)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (5)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (6)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (7)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (8)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (9)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (10)",                         "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (11)",                         "SSS",                     2.10, 10),
      p_("Radnik u primci (1)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (2)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (3)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (4)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (5)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (6)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (7)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (8)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (9)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (10)",                              "SSS",                     1.75, 10),
      p_("Radnik u primci (11)",                              "SSS",                     1.75, 10),
      p_("Otpremaƒç drvnih sortimenata (1)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (2)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (3)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (4)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (5)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (6)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (7)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (8)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (9)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (10)",                  "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (11)",                  "SSS",                     1.95, 5),
      p_("Osmatraƒç ≈°uma i ≈°umskog zemlji≈°ta",                 "SSS/KV",                  1.75, 10),
      p_("Vozaƒç - Pomoƒáni radnik (1)",                        "SSS/KV kat. B",           1.81),
      p_("Vozaƒç - Pomoƒáni radnik (2)",                        "SSS/KV kat. B",           1.81),
      p_("Domar - Lo≈æaƒç - Kurir",                             "SSS/KV",                  1.76),
      p_("ƒåistaƒçica (1)",                                     "NK",                      1.50),
      p_("ƒåistaƒçica (2)",                                     "NK",                      1.50),
      p_("Sjekaƒç (1)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (2)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (3)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (4)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (5)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (6)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (7)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (8)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (9)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (10)",                                       "PK",                      1.64, 10),
      p_("Uzgojni radnik",                                    "PK",                      1.56, 10),
      p_("Traktorista - Pomoƒáni radnik (1)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (2)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (3)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (4)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (5)",                  "KV/PK",                   1.75, 10),
      p_("Magaciner - Mehaniƒçar motornih pila",               "SSS/KV",                  1.81)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA ≈†UMARIJA KLJUƒå ‚ïê‚ïê
    "PODRU≈ΩNICA ≈†UMARIJA KLJUƒå": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.81),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    3.24),
      p_("Tehnolog za gospodarenje ≈°umama",                   "VSS VII/240-300 ECTS",    3.09, 5),
      p_("Evidentiƒçar",                                       "SSS",                     1.81),
      p_("Administrativni radnik - Operater",                 "SSS",                     1.81),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (1)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (2)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (3)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (1)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (2)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (3)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa vlastite re≈æije",                         "VSS VII/180 / SSS",       2.07, 6),
      p_("Primaƒç na ≈°uma panju (1)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (2)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (3)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (4)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (5)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (6)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (7)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (8)",                          "SSS",                     2.10, 10),
      p_("Radnik u primci (1)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (2)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (3)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (4)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (5)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (6)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (7)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (8)",                               "SSS",                     1.75, 10),
      p_("Otpremaƒç drvnih sortimenata (1)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (2)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (3)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (4)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (5)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (6)",                   "SSS",                     1.95, 5),
      p_("Osmatraƒç ≈°uma i ≈°umskog zemlji≈°ta",                 "SSS/KV",                  1.75, 10),
      p_("Vozaƒç - Pomoƒáni radnik (1)",                        "SSS/KV kat. B",           1.81),
      p_("Vozaƒç - Pomoƒáni radnik (2)",                        "SSS/KV kat. B",           1.81),
      p_("Domar - Lo≈æaƒç - Kurir - Magaciner",                 "SSS/KV",                  1.81),
      p_("ƒåistaƒçica",                                         "NK",                      1.50),
      p_("Sjekaƒç (1)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (2)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (3)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (4)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (5)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (6)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (7)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (8)",                                        "PK",                      1.64, 10),
      p_("Uzgojni radnik",                                    "PK",                      1.56, 10),
      p_("Automehaniƒçar (1)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (2)",                                 "KV",                      1.81, 6),
      p_("Traktorista - Pomoƒáni radnik (1)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (2)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (3)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (4)",                  "KV/PK",                   1.75, 10)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA ≈†UMARIJA CAZIN ‚ïê‚ïê
    "PODRU≈ΩNICA ≈†UMARIJA CAZIN": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.52),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    3.05),
      p_("Tehnolog za gospodarenje ≈°umama",                   "VSS VII/240-300 ECTS",    3.09, 5),
      p_("Administrativni radnik - Operater",                 "SSS",                     1.81),
      p_("Evidentiƒçar",                                       "SSS",                     1.81),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (1)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (2)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa iskori≈°tavanja ≈°uma (3)",                 "VSS VII/180 / SSS",       2.16, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (1)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (2)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa uzgoja, za≈°tite ≈°uma i ekologije (3)",    "VSS VII/180 / SSS",       2.07, 6),
      p_("Poslovoƒëa vlastite re≈æije",                         "VSS VII/180 / SSS",       2.07, 6),
      p_("Primaƒç na ≈°uma panju (1)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (2)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (3)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (4)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (5)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (6)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (7)",                          "SSS",                     2.10, 10),
      p_("Primaƒç na ≈°uma panju (8)",                          "SSS",                     2.10, 10),
      p_("Radnik u primci (1)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (2)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (3)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (4)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (5)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (6)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (7)",                               "SSS",                     1.75, 10),
      p_("Radnik u primci (8)",                               "SSS",                     1.75, 10),
      p_("Otpremaƒç drvnih sortimenata (1)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (2)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (3)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (4)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (5)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (6)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (7)",                   "SSS",                     1.95, 5),
      p_("Otpremaƒç drvnih sortimenata (8)",                   "SSS",                     1.95, 5),
      p_("Osmatraƒç ≈°uma i ≈°umskog zemlji≈°ta",                 "SSS/KV",                  1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (1)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (2)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (3)",                  "KV/PK",                   1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (4)",                  "KV/PK",                   1.75, 10),
      p_("Vozaƒç - Pomoƒáni radnik (1)",                        "SSS/KV kat. B",           1.81),
      p_("Vozaƒç - Pomoƒáni radnik (2)",                        "SSS/KV kat. B",           1.81),
      p_("Domar - Lo≈æaƒç - Kurir - Magaciner",                 "SSS/KV",                  1.81),
      p_("ƒåistaƒçica (1)",                                     "NK",                      1.50),
      p_("ƒåistaƒçica (2)",                                     "NK",                      1.50),
      p_("Sjekaƒç (1)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (2)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (3)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (4)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (5)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (6)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (7)",                                        "PK",                      1.64, 10),
      p_("Sjekaƒç (8)",                                        "PK",                      1.64, 10),
      p_("Uzgojni radnik",                                    "PK",                      1.56, 10),
      p_("Portir - Pomoƒáni radnik",                           "SSS/NK",                  1.62)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA RASADNIK CAZIN ‚ïê‚ïê
    "PODRU≈ΩNICA RASADNIK CAZIN": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.33),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    2.76),
      p_("Poslovoƒëa za rasadniƒçku proizvodnju i sjemenarstvo","SSS",                     2.09),
      p_("Referent za organizaciju proizvodnje",              "VSS VII/180-240 ECTS",    2.60),
      p_("Administrativni radnik - Evidentiƒçar - Operater",   "SSS",                     1.81),
      p_("Poslovoƒëa za hortikulturnu proizvodnju - Magaciner","SSS",                     2.09),
      p_("Mehaniƒçar - Vozaƒç",                                 "KV",                      1.75, 10),
      p_("Traktorista - Pomoƒáni radnik (1)",                  "KV/PK",                   1.67, 6),
      p_("Traktorista - Pomoƒáni radnik (2)",                  "KV/PK",                   1.67, 6),
      p_("Rasadniƒçar - Pomoƒáni radnik (1)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (2)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (3)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (4)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (5)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (6)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (7)",                   "PK",                      1.54, 10),
      p_("Rasadniƒçar - Pomoƒáni radnik (8)",                   "PK",                      1.54, 10),
      p_("Pomoƒáni radnik",                                    "NK",                      1.40, 10),
      p_("ƒåistaƒçica - Kurir",                                 "NK",                      1.50)
    ],

    // ‚ïê‚ïê POGON GOSPODARENJA ZA OPƒÜINU BOSANSKA KRUPA ‚ïê‚ïê
    "POGON GOSPODARENJA ZA OPƒÜINU BOSANSKA KRUPA": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.81),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    3.24),
      p_("Referent kamionskih puteva i graƒëevina - Glavni in≈æinjer","VSS VII/180-240 ECTS",2.69),
      p_("Tehniƒçki rukovodilac kamenoloma",                   "VSS VII/180-240 ECTS",    2.60),
      p_("Poslovoƒëa odr≈æavanja ma≈°ina i vozila",              "SSS/VKV",                 2.09),
      p_("Poslovoƒëa mehanizacije i transporta",               "SSS",                     2.09),
      p_("Administrativni radnik - Evidentiƒçar - Operater",   "SSS",                     1.81),
      p_("Magaciner - Radnik na pumpi",                       "SSS",                     1.81),
      p_("Automehaniƒçar (1)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (2)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (3)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (4)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (5)",                                 "KV",                      1.81, 6),
      p_("Bravar - Mehaniƒçar",                                "KV",                      1.81, 6),
      p_("Tokar - Mehaniƒçar",                                 "KV",                      1.81, 6),
      p_("Autoelektriƒçar - Mehaniƒçar",                        "KV",                      1.81, 6),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (1)",          "KV/PK",                   1.75, 10),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (2)",          "KV/PK",                   1.75, 10),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (3)",          "KV/PK",                   1.75, 10),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (4)",          "KV/PK",                   1.75, 10),
      p_("Vozaƒç kamiona (1)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (2)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (3)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (4)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (5)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (6)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (7)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (8)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (9)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (10)",                                "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (11)",                                "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (12)",                                "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (13)",                                "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (14)",                                "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (15)",                                "SSS/KV",                  1.81),
      p_("Rukovaoc rovokopaƒçem (1)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc rovokopaƒçem (2)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc rovokopaƒçem (3)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc rovokopaƒçem (4)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc rovokopaƒçem (5)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc utovarivaƒçem (1)",                         "SSS/KV",                  1.90),
      p_("Rukovaoc utovarivaƒçem (2)",                         "SSS/KV",                  1.90),
      p_("Rukovaoc greiderom (1)",                            "SSS/KV",                  1.90),
      p_("Rukovaoc greiderom (2)",                            "SSS/KV",                  1.90),
      p_("Rukovaoc valjkom",                                  "SSS/KV",                  1.90),
      p_("Rukovaoc buldo≈æerom",                               "SSS/KV",                  1.90),
      p_("Rukovaoc mje≈°alicom betona - Pomoƒáni radnik",       "KV/NK",                   1.40, 10),
      p_("Rukovaoc postrojenjima u kamenolomu - Pom. radnik", "KV/NK",                   1.40, 10),
      p_("Pomoƒáni radnik",                                    "NK",                      1.40, 10),
      p_("ƒåistaƒçica",                                         "NK",                      1.50)
    ],

    // ‚ïê‚ïê PODRU≈ΩNICA GRAƒêENJE MEHANIZACIJA I ODR≈ΩAVANJE BOSANSKI PETROVAC ‚ïê‚ïê
    "PODRU≈ΩNICA GRAƒêENJE MEHANIZACIJA I ODR≈ΩAVANJE BOSANSKI PETROVAC": [
      p_("Upravnik",                                          "VSS VII/240-300 ECTS",    3.43),
      p_("Pomoƒánik upravnika",                                "VSS VII/240-300 ECTS",    3.05),
      p_("Referent kamionskih puteva i graƒëevina",            "VSS VII/180-240 ECTS",    2.69),
      p_("Poslovoƒëa odr≈æavanja ma≈°ina i vozila",              "SSS/VKV",                 2.09),
      p_("Poslovoƒëa mehanizacije i transporta",               "SSS",                     2.09),
      p_("Administrativni radnik - Evidentiƒçar - Operater",   "SSS",                     1.81),
      p_("Magaciner - Radnik na pumpi",                       "SSS",                     1.81),
      p_("Automehaniƒçar (1)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (2)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (3)",                                 "KV",                      1.81, 6),
      p_("Automehaniƒçar (4)",                                 "KV",                      1.81, 6),
      p_("Bravar - Mehaniƒçar",                                "KV",                      1.81, 6),
      p_("Tokar - Mehaniƒçar",                                 "KV",                      1.81, 6),
      p_("Autoelektriƒçar - Mehaniƒçar",                        "KV",                      1.81, 6),
      p_("Vozaƒç kamiona (1)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (2)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (3)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (4)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (5)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (6)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (7)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (8)",                                 "SSS/KV",                  1.81),
      p_("Vozaƒç kamiona (9)",                                 "SSS/KV",                  1.81),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (1)",          "KV/PK",                   1.75, 10),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (2)",          "KV/PK",                   1.75, 10),
      p_("Traktorista - Vozaƒç - Pomoƒáni radnik (3)",          "KV/PK",                   1.75, 10),
      p_("Rukovaoc rovokopaƒçem (1)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc rovokopaƒçem (2)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc rovokopaƒçem (3)",                          "SSS/KV",                  1.90),
      p_("Rukovaoc utovarivaƒçem",                             "SSS/KV",                  1.90),
      p_("Rukovaoc greiderom",                                "SSS/KV",                  1.90),
      p_("Rukovaoc valjkom",                                  "SSS/KV",                  1.90),
      p_("Rukovaoc buldo≈æerom",                               "SSS/KV",                  1.90),
      p_("ƒåistaƒçica",                                         "NK",                      1.50)
    ]
  };
const STORAGE_KEY = 'org_structure_data_v4';
let currentEditNode = null, currentParentNode = null;
let currentUnitForPositions = null, selectedPosition = null;
let draggedPositionIndex = null;
let currentEmployeeCtx = { unitName: null, index: null };

// Zoom state
let currentZoom = 1;
const ZOOM_MIN = 0.3, ZOOM_MAX = 3, ZOOM_STEP = 0.15;

// Platform
let currentPlatform = 'desktop';

// Touch pan/pinch state
let isPinching = false, isPointerDown = false;
let lastPinchDist = 0;
let panStartX = 0, panStartY = 0;
let scrollStartX = 0, scrollStartY = 0;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PLATFORM SWITCHER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openPlatformModal() { document.getElementById('platformModal').classList.add('active'); updatePlatformUI(); }
function closePlatformModal() { document.getElementById('platformModal').classList.remove('active'); }
function setPlatform(plat) {
    currentPlatform = plat;
    document.body.className = 'mode-' + plat;
    document.getElementById('platIcon').textContent = plat === 'mobile' ? 'üì±' : 'üñ•Ô∏è';
    document.getElementById('platLabel').textContent = plat === 'mobile' ? 'Mobitel' : 'Desktop';
    // Update active state in modal buttons
    document.getElementById('platDesktop').classList.toggle('active', plat === 'desktop');
    document.getElementById('platMobile').classList.toggle('active', plat === 'mobile');
    closePlatformModal();
    // Show pinch hint briefly on mobile
    if (plat === 'mobile') showPinchHint();
    localStorage.setItem('spd_platform', plat);
    updateHeaderHeight();
}
function updatePlatformUI() {
    document.getElementById('platDesktop').classList.toggle('active', currentPlatform === 'desktop');
    document.getElementById('platMobile').classList.toggle('active', currentPlatform === 'mobile');
}
function showPinchHint() {
    const h = document.getElementById('pinchHint');
    h.classList.add('show');
    setTimeout(() => h.classList.remove('show'), 2800);
}
function updateHeaderHeight() {
    const hdr = document.querySelector('.header');
    const headerH = hdr ? hdr.offsetHeight : 88;
    document.documentElement.style.setProperty('--header-h', headerH + 'px');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ZOOM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applyZoom(z, pivotX, pivotY) {
    const wrapper = document.getElementById('zoomWrapper');
    const outer = document.getElementById('outerScroll');
    const oldZoom = currentZoom;
    currentZoom = Math.min(ZOOM_MAX, Math.max(ZOOM_MIN, z));
    wrapper.style.transform = `scale(${currentZoom})`;
    wrapper.style.transformOrigin = 'top left';
    document.getElementById('zoomLabel').textContent = Math.round(currentZoom * 100) + '%';

    // Adjust scroll to keep pivot point stable
    if (pivotX !== undefined && outer) {
        const ratio = currentZoom / oldZoom;
        outer.scrollLeft = (outer.scrollLeft + pivotX) * ratio - pivotX;
        outer.scrollTop  = (outer.scrollTop  + pivotY) * ratio - pivotY;
    }
}
function zoomIn()    { applyZoom(currentZoom + ZOOM_STEP); }
function zoomOut()   { applyZoom(currentZoom - ZOOM_STEP); }
function resetZoom() { applyZoom(1); document.getElementById('outerScroll').scrollTo(0, 0); }

// Desktop: Ctrl+Scroll zoom
document.addEventListener('wheel', e => {
    if (e.ctrlKey) {
        e.preventDefault();
        const outer = document.getElementById('outerScroll');
        const rect  = outer.getBoundingClientRect();
        const px = e.clientX - rect.left;
        const py = e.clientY - rect.top;
        applyZoom(currentZoom + (e.deltaY < 0 ? ZOOM_STEP : -ZOOM_STEP), px, py);
    }
}, { passive: false });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOUCH EVENTS ‚Äî Pinch zoom + Pan (mobile mode)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getTouchDist(t1, t2) {
    return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
}
function getTouchMidpoint(t1, t2) {
    return { x: (t1.clientX + t2.clientX) / 2, y: (t1.clientY + t2.clientY) / 2 };
}

const outerEl = () => document.getElementById('outerScroll');

document.addEventListener('touchstart', e => {
    if (currentPlatform !== 'mobile') return;
    const touches = e.touches;
    if (touches.length === 2) {
        isPinching = true;
        isPointerDown = false;
        lastPinchDist = getTouchDist(touches[0], touches[1]);
        e.preventDefault();
    } else if (touches.length === 1) {
        isPinching = false;
        isPointerDown = true;
        const el = document.getElementById('zoomWrapper');
        // Only pan if touching the tree area
        if (e.target.closest('#outerScroll')) {
            panStartX = touches[0].clientX;
            panStartY = touches[0].clientY;
            scrollStartX = outerEl().scrollLeft;
            scrollStartY = outerEl().scrollTop;
        }
    }
}, { passive: false });

document.addEventListener('touchmove', e => {
    if (currentPlatform !== 'mobile') return;
    const touches = e.touches;
    if (isPinching && touches.length === 2) {
        e.preventDefault();
        const dist = getTouchDist(touches[0], touches[1]);
        const mid  = getTouchMidpoint(touches[0], touches[1]);
        const outer = outerEl();
        const rect = outer.getBoundingClientRect();
        const px = mid.x - rect.left;
        const py = mid.y - rect.top;
        const scale = dist / lastPinchDist;
        applyZoom(currentZoom * scale, px, py);
        lastPinchDist = dist;
    } else if (isPointerDown && touches.length === 1 && !e.target.closest('.modal')) {
        e.preventDefault();
        const dx = panStartX - touches[0].clientX;
        const dy = panStartY - touches[0].clientY;
        outerEl().scrollLeft = scrollStartX + dx;
        outerEl().scrollTop  = scrollStartY + dy;
    }
}, { passive: false });

document.addEventListener('touchend', e => {
    if (e.touches.length < 2) isPinching = false;
    if (e.touches.length === 0) isPointerDown = false;
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function posTitle_(p) { if (typeof p === 'string') return p; if (p && typeof p === 'object') return String(p.title || p.name || ''); return ''; }
function posEmployee_(p) {
    if (!p || typeof p !== 'object') return null;
    if (!p.employee || typeof p.employee !== 'object') p.employee = { name:'', education:'', experience:'', other:'' };
    else { p.employee.name = p.employee.name||''; p.employee.education = p.employee.education||''; p.employee.experience = p.employee.experience||''; p.employee.other = p.employee.other||''; }
    return p.employee;
}
function ensurePosObject_(unitName, index) {
    if (!orgPositions[unitName]) orgPositions[unitName] = [];
    let p = orgPositions[unitName][index];
    if (typeof p === 'string') { p = { title: p, employee: { name:'', education:'', experience:'', other:'' } }; orgPositions[unitName][index] = p; }
    else if (p && typeof p === 'object') { p.title = String(p.title || p.name || ''); posEmployee_(p); }
    return orgPositions[unitName][index];
}
function setSaveStatus(msg) { const el = document.getElementById('syncStatus'); if (el) el.textContent = msg; }
function showToast(msg) {
    document.querySelectorAll('.toast').forEach(t => t.remove());
    const t = document.createElement('div'); t.className = 'toast'; t.textContent = msg;
    document.body.appendChild(t); setTimeout(() => t.remove(), 3000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOAD / SAVE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadData() {
    const isGAS = (typeof google !== 'undefined' && google.script && google.script.run);
    if (isGAS) {
        setSaveStatus('Uƒçitavanje...');
        google.script.run
            .withSuccessHandler(r => {
                try { if (r && r.ok && r.schema) { organizationalStructure = r.schema.organizationalStructure; orgPositions = r.schema.orgPositions || {}; } } catch(e) {}
                renderTree(); setSaveStatus('Spremno');
            })
            .withFailureHandler(err => {
                console.error(err); setSaveStatus('Gre≈°ka');
                try { const s = localStorage.getItem(STORAGE_KEY+'_structure'); const p = localStorage.getItem(STORAGE_KEY+'_positions'); if(s) organizationalStructure = JSON.parse(s); if(p) orgPositions = JSON.parse(p); } catch(e) {}
                renderTree();
            }).getSchema();
        return;
    }
    try { const s = localStorage.getItem(STORAGE_KEY+'_structure'); const p = localStorage.getItem(STORAGE_KEY+'_positions'); if(s) organizationalStructure = JSON.parse(s); if(p) orgPositions = JSON.parse(p); } catch(e) {}
    renderTree(); setSaveStatus('Offline');
}
async function saveData() {
    const isGAS = (typeof google !== 'undefined' && google.script && google.script.run);
    try {
        setSaveStatus('Spremanje...');
        if (isGAS) {
            await new Promise((res, rej) => { google.script.run.withSuccessHandler(() => { setSaveStatus('Spremno'); res(); }).withFailureHandler(e => { setSaveStatus('Gre≈°ka'); rej(e); }).saveSchema({ organizationalStructure, orgPositions }); });
            return;
        }
        localStorage.setItem(STORAGE_KEY+'_structure', JSON.stringify(organizationalStructure));
        localStorage.setItem(STORAGE_KEY+'_positions', JSON.stringify(orgPositions));
        setSaveStatus('Offline');
    } catch(e) { setSaveStatus('Gre≈°ka'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTree() {
    const c = document.getElementById('orgTree'); if (!c) return;
    c.innerHTML = '';
    if (!organizationalStructure) { c.innerHTML = '<p style="color:#666;text-align:center;padding:2rem;">Uƒçitavanje...</p>'; return; }
    c.appendChild(createNodeElement(organizationalStructure));
}
function createNodeElement(node) {
    const nd = document.createElement('div'); nd.className = 'tree-node'; nd.dataset.nodeId = node.id;
    const card = document.createElement('div'); card.className = `node-card level-${node.level}`;
    const title = document.createElement('div'); title.className = 'node-title'; title.textContent = node.name; card.appendChild(title);
    const positions = orgPositions[node.name] || [];
    if (positions.length > 0) {
        const prev = document.createElement('div'); prev.className = 'positions-preview';
        prev.textContent = `üìã ${positions.length} pozicija`;
        prev.onclick = e => { e.stopPropagation(); showPositions(node); }; card.appendChild(prev);
        const badge = document.createElement('span'); badge.className = 'node-badge'; badge.textContent = positions.length; card.appendChild(badge);
    }
    const actions = document.createElement('div'); actions.className = 'node-actions';
    const btns = [
        ['‚úèÔ∏è Uredi', 'btn-secondary', () => editUnit(node)],
        ['‚ûï Podreƒëena', 'btn-primary', () => addChildUnit(node)],
        ['üë• Pozicije', 'btn-secondary', () => showPositions(node)]
    ];
    btns.forEach(([html, cls, fn]) => {
        const b = document.createElement('button'); b.className = `btn ${cls} btn-small`; b.innerHTML = html;
        b.onclick = e => { e.stopPropagation(); fn(); }; actions.appendChild(b);
    });
    if (node.id !== 'uprava') {
        const db = document.createElement('button'); db.className = 'btn btn-danger btn-small'; db.innerHTML = 'üóëÔ∏è';
        db.onclick = e => { e.stopPropagation(); deleteUnit(node); }; actions.appendChild(db);
    }
    card.appendChild(actions); nd.appendChild(card);
    if (node.children && node.children.length > 0) {
        const con = document.createElement('div'); con.className = 'connector'; nd.appendChild(con);
        const ch = document.createElement('div'); ch.className = 'children';
        node.children.forEach(c => ch.appendChild(createNodeElement(c)));
        nd.appendChild(ch);
    }
    return nd;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UNIT CRUD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addRootUnit()      { currentEditNode = null; currentParentNode = organizationalStructure; openUnitModal('Dodaj novu jedinicu'); }
function addChildUnit(pn)   { currentEditNode = null; currentParentNode = pn; openUnitModal('Dodaj podreƒëenu jedinicu'); }
function editUnit(node)     { currentEditNode = node; currentParentNode = null; document.getElementById('unitName').value = node.name; openUnitModal('Uredi jedinicu'); }
function deleteUnit(node)   {
    if (!confirm(`Obrisati "${node.name}"?\n\nOvo bri≈°e i sve podreƒëene jedinice i pozicije.`)) return;
    delete orgPositions[node.name];
    function rem(p) { if (!p.children) return false; const i = p.children.findIndex(c => c.id === node.id); if (i !== -1) { p.children.splice(i, 1); return true; } for (let c of p.children) if (rem(c)) return true; return false; }
    rem(organizationalStructure); saveData(); renderTree(); showToast('Jedinica obrisana');
}
function openUnitModal(t)   { document.getElementById('modalTitle').textContent = t; document.getElementById('unitModal').classList.add('active'); if (!currentEditNode) document.getElementById('unitName').value = ''; }
function closeUnitModal()   { document.getElementById('unitModal').classList.remove('active'); currentEditNode = null; currentParentNode = null; }
document.getElementById('unitForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('unitName').value.trim();
    if (!name) { showToast('Naziv je obavezan'); return; }
    if (currentEditNode) {
        const old = currentEditNode.name; currentEditNode.name = name;
        if (old !== name && orgPositions[old]) { orgPositions[name] = orgPositions[old]; delete orgPositions[old]; }
        showToast('Jedinica a≈æurirana');
    } else {
        const nn = { id: 'unit-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9), name, level: currentParentNode.level + 1, children: [] };
        if (!currentParentNode.children) currentParentNode.children = [];
        currentParentNode.children.push(nn); orgPositions[name] = []; showToast('Jedinica dodana');
    }
    saveData(); renderTree(); closeUnitModal();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// POZICIJE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPositions(node) {
    currentUnitForPositions = node;
    document.getElementById('posModalTitle').textContent = `Pozicije ‚Äî ${node.name}`;
    const container = document.getElementById('positionsList'); container.innerHTML = '';
    const positions = orgPositions[node.name] || [];
    if (!positions.length) { container.innerHTML = '<p style="color:#666;text-align:center;padding:1rem;">Nema pozicija</p>'; }
    else {
        positions.forEach((pos, idx) => {
            const item = document.createElement('div'); item.className = 'position-item'; item.draggable = true; item.dataset.index = idx;
            item.addEventListener('dragstart', handleDragStart); item.addEventListener('dragend', handleDragEnd);
            item.addEventListener('dragover', handleDragOver); item.addEventListener('drop', handleDrop);
            // Handle
            const handle = document.createElement('span'); handle.className = 'drag-handle'; handle.innerHTML = '‚ãÆ‚ãÆ'; item.appendChild(handle);
            // Info
            const info = document.createElement('div'); info.className = 'pos-info'; info.onclick = () => openEmployeeModal(node.name, idx);
            const t = document.createElement('div'); t.className = 'pos-title'; t.textContent = posTitle_(pos); info.appendChild(t);
            if (pos && typeof pos === 'object' && pos.stepen) { const s = document.createElement('div'); s.className = 'pos-sub'; s.textContent = pos.stepen; info.appendChild(s); }
            item.appendChild(info);
            // Koeficijent
            if (pos && typeof pos === 'object') {
                const kCol = document.createElement('div'); kCol.className = 'koef-col';
                if (pos.koef !== null && pos.koef !== undefined) {
                    const k = document.createElement('span'); k.className = 'koef-tag koef-val';
                    k.textContent = `K: ${(pos.usloviRada > 0 && pos.ukupno) ? pos.ukupno : pos.koef}`; kCol.appendChild(k);
                    if (pos.usloviRada > 0) { const ur = document.createElement('span'); ur.className = 'koef-tag koef-ur'; ur.textContent = `UR: ${pos.usloviRada}%`; kCol.appendChild(ur); }
                } else if (pos.napomena) { const st = document.createElement('span'); st.className = 'koef-tag koef-stat'; st.textContent = 'Ugovor'; kCol.appendChild(st); }
                item.appendChild(kCol);
            }
            // Radnik
            if (pos && typeof pos === 'object' && pos.employee && pos.employee.name) { const m = document.createElement('span'); m.className = 'emp-tag'; m.textContent = `üë§ ${pos.employee.name}`; item.appendChild(m); }
            // Actions
            const actDiv = document.createElement('div'); actDiv.className = 'position-actions';
            const moveB = document.createElement('button'); moveB.className = 'btn btn-secondary btn-small'; moveB.innerHTML = '‚ÜîÔ∏è';
            moveB.onclick = e => { e.stopPropagation(); selectedPosition = { index: idx, pos: positions[idx], title: posTitle_(positions[idx]) }; openMoveModal(); }; actDiv.appendChild(moveB);
            const delB = document.createElement('button'); delB.className = 'btn btn-danger btn-small'; delB.innerHTML = 'üóëÔ∏è';
            delB.onclick = e => { e.stopPropagation(); deletePosition(idx); }; actDiv.appendChild(delB);
            item.appendChild(actDiv); container.appendChild(item);
        });
    }
    document.getElementById('positionModal').classList.add('active');
}
function closePositionModal() { document.getElementById('positionModal').classList.remove('active'); currentUnitForPositions = null; }
function addPosition() {
    const n = prompt('Unesite naziv pozicije:'); if (!n || !n.trim()) return;
    if (!orgPositions[currentUnitForPositions.name]) orgPositions[currentUnitForPositions.name] = [];
    orgPositions[currentUnitForPositions.name].push({ title: n.trim(), employee: { name:'', education:'', experience:'', other:'' } });
    saveData(); showPositions(currentUnitForPositions); renderTree(); showToast('Pozicija dodana');
}
function deletePosition(index) {
    if (!confirm('Obrisati ovu poziciju?')) return;
    orgPositions[currentUnitForPositions.name].splice(index, 1);
    saveData(); showPositions(currentUnitForPositions); renderTree(); showToast('Pozicija obrisana');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAG & DROP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleDragStart(e) { draggedPositionIndex = parseInt(e.target.dataset.index); e.target.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; }
function handleDragEnd(e)   { e.target.classList.remove('dragging'); }
function handleDragOver(e)  { if (e.preventDefault) e.preventDefault(); const t = e.target.closest('.position-item'); if (t && t.dataset.index !== String(draggedPositionIndex)) t.classList.add('drag-over'); return false; }
function handleDrop(e) {
    if (e.stopPropagation) e.stopPropagation();
    const t = e.target.closest('.position-item'); if (!t) return false;
    t.classList.remove('drag-over');
    const di = parseInt(t.dataset.index);
    if (draggedPositionIndex !== di) {
        const p = orgPositions[currentUnitForPositions.name]; const drag = p[draggedPositionIndex]; p.splice(draggedPositionIndex, 1);
        p.splice(draggedPositionIndex < di ? di - 1 : di, 0, drag);
        saveData(); showPositions(currentUnitForPositions); renderTree();
    }
    return false;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOVE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openMoveModal() {
    const sel = document.getElementById('targetUnitSelect'); sel.innerHTML = '';
    function ao(n, prefix = '') { const opt = document.createElement('option'); opt.value = n.name; opt.textContent = prefix + n.name; if (n.name !== currentUnitForPositions.name) sel.appendChild(opt); if (n.children) n.children.forEach(c => ao(c, prefix + '  ')); }
    ao(organizationalStructure);
    document.getElementById('movingPositionName').textContent = selectedPosition.title;
    document.getElementById('moveModal').classList.add('active');
}
function closeMoveModal() { document.getElementById('moveModal').classList.remove('active'); selectedPosition = null; }
function confirmMovePosition() {
    const target = document.getElementById('targetUnitSelect').value;
    if (!target) { showToast('Odaberite odredi≈°nu jedinicu'); return; }
    orgPositions[currentUnitForPositions.name].splice(selectedPosition.index, 1);
    if (!orgPositions[target]) orgPositions[target] = [];
    orgPositions[target].push(selectedPosition.pos);
    saveData(); showPositions(currentUnitForPositions); renderTree(); closeMoveModal(); showToast(`Premje≈°teno u ${target}`);
}
function movePositionToUnit() { if (!selectedPosition) { showToast('Prvo oznaƒçite poziciju'); return; } openMoveModal(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMPLOYEE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openEmployeeModal(unitName, index) {
    currentEmployeeCtx = { unitName, index };
    const p = ensurePosObject_(unitName, index); const emp = posEmployee_(p);
    document.getElementById('empModalTitle').textContent = `Radnik ‚Äì ${posTitle_(p)}`;
    document.getElementById('empName').value = emp.name || '';
    document.getElementById('empEducation').value = emp.education || '';
    document.getElementById('empExperience').value = emp.experience || '';
    document.getElementById('empOther').value = emp.other || '';
    document.getElementById('employeeModal').classList.add('active');
}
function closeEmployeeModal() { document.getElementById('employeeModal').classList.remove('active'); currentEmployeeCtx = { unitName: null, index: null }; }
document.getElementById('employeeForm').addEventListener('submit', e => {
    e.preventDefault();
    const { unitName, index } = currentEmployeeCtx; if (!unitName && unitName !== '') return;
    const p = ensurePosObject_(unitName, index); const emp = posEmployee_(p);
    emp.name = document.getElementById('empName').value.trim();
    emp.education = document.getElementById('empEducation').value.trim();
    emp.experience = document.getElementById('empExperience').value.trim();
    emp.other = document.getElementById('empOther').value.trim();
    saveData(); renderTree();
    if (currentUnitForPositions && currentUnitForPositions.name === unitName) showPositions(currentUnitForPositions);
    closeEmployeeModal(); showToast('Podaci saƒçuvani');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEARCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('searchInput').addEventListener('input', e => {
    const q = e.target.value.toLowerCase();
    document.querySelectorAll('.tree-node').forEach(node => {
        const card = node.querySelector('.node-card');
        const text = card.querySelector('.node-title').textContent.toLowerCase();
        const un = findNodeById(organizationalStructure, node.dataset.nodeId);
        const positions = un ? (orgPositions[un.name] || []) : [];
        const hpm = positions.some(p => posTitle_(p).toLowerCase().includes(q));
        if (text.includes(q) || hpm || !q) { node.style.display = 'flex'; card.style.background = (text.includes(q) || hpm) && q ? '#fffbeb' : ''; }
        else node.style.display = 'none';
    });
});
function findNodeById(node, id) { if (node.id === id) return node; if (!node.children) return null; for (let c of node.children) { const f = findNodeById(c, id); if (f) return f; } return null; }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT / IMPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportData() {
    saveData();
    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url;
    a.download = `organizacijska_sema_${new Date().toISOString().split('T')[0]}.html`;
    a.click(); URL.revokeObjectURL(url); showToast('HTML fajl izvezen');
}
function importData() { const i = document.createElement('input'); i.type = 'file'; i.accept = '.html,.json'; i.onchange = handleImport; i.click(); }
async function handleImport(event) {
    const file = event.target.files[0]; if (!file) return;
    try {
        const text = await file.text(); let importedData = null;
        if (file.name.endsWith('.json')) { const d = JSON.parse(text); if (d.structure && d.positions) importedData = d; }
        else if (file.name.endsWith('.html')) {
            const parser = new DOMParser(); const doc = parser.parseFromString(text, 'text/html');
            for (let s of doc.getElementsByTagName('script')) { const st = s.textContent; if (st.includes('let organizationalStructure = {')) { try { const m = st.match(/let organizationalStructure = ({[\s\S]*?});[\s\S]*?let orgPositions = ({[\s\S]*?});/); if (m) { importedData = { structure: eval('(' + m[1] + ')'), positions: eval('(' + m[2] + ')') }; break; } } catch(ex) {} } }
        }
        if (importedData && importedData.structure && importedData.positions) {
            if (confirm('Uvesti podatke? Ovo zamjenjuje trenutne podatke.')) { Object.assign(organizationalStructure, importedData.structure); orgPositions = importedData.positions; await saveData(); renderTree(); showToast('Podaci uvezeni'); }
        } else showToast('Nije pronaƒëen validan format');
    } catch(e) { showToast('Gre≈°ka: ' + e.message); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOSE MODALS ON BACKDROP CLICK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
['unitModal','positionModal','moveModal','employeeModal','platformModal'].forEach(id => {
    document.getElementById(id).addEventListener('click', e => {
        if (e.target.id === id) {
            if (id === 'unitModal')       closeUnitModal();
            if (id === 'positionModal')   closePositionModal();
            if (id === 'moveModal')       closeMoveModal();
            if (id === 'employeeModal')   closeEmployeeModal();
            if (id === 'platformModal')   closePlatformModal();
        }
    });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function init() {
    // Auto-detect mobile
    const saved = localStorage.getItem('spd_platform');
    const isMobile = /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);
    const plat = saved || (isMobile ? 'mobile' : 'desktop');
    setPlatform(plat);
    updateHeaderHeight();
    window.addEventListener('resize', updateHeaderHeight);
    loadData();
    // Show pinch hint on first mobile visit
    if (!saved && isMobile) setTimeout(showPinchHint, 1200);
})();

window.addEventListener('storage', e => {
    if (e.key && e.key.startsWith(STORAGE_KEY) && e.newValue) { loadData(); showToast('A≈æurirano'); }
});
</script>
</body>
</html>
